# flutter_parent

A new Flutter project.

## Getting Started

This project is a starting point for a Flutter application.

A few resources to get you started if this is your first Flutter project:

- [Lab: Write your first Flutter app](https://flutter.dev/docs/get-started/codelab)
- [Cookbook: Useful Flutter samples](https://flutter.dev/docs/cookbook)

For help getting started with Flutter, view our
[online documentation](https://flutter.dev/docs), which offers tutorials,
samples, guidance on mobile development, and a full API reference.

## Localization

Localization is not built in to flutter like it is with native Android.
Instead, we need to use the `intl` and `flutter_localizations` libraries.
This will allow us to have different translations being used depending
on the users locale.

It's pretty easy to use, once set up. To add a new string, create a new
getter in `lib/l10n/app_localizations.dart` that looks something like this:
```
  // The 'name' field must match the function name, and is optional unless arguments are part of the string resource

  String get myCoolNewString(String foo) {
    return Intl.message('Cool string here: $foo', name: 'myCoolNewString', args: [foo], desc: 'A description to help translators');
  }
```

Then, to use the newly created string, access it like so using a BuildContext:
```
final alertTabLabel = AppLocalizations.of(context).myCoolNewString('bar');
```

That is the basics of using the `intl` library for localized strings!

### Automating Imports
Generated files are created through a dev dependency of `intl_translation`.

The base strings are held in `lib/l10n/res/intl_messages.arb` and each
translation is held in `lib/l10n/res/intl_*.arb` where * is the language
identifier. e.g., `intl_en_unimelb_AU.arb` has the locale identifier
`en_unimelb_AU`.

Linking the translations back in will generate a
`lib/l10n/generated/messages_*.dart` for each `intl_*.arb` that is
provided. It will also generate a `messages_all.dart` to be able to
actually perform the lookups. The `AppLocalization#load` function hooks
into this by calling `initializeMessages` from the `messages_all.dart` file.

Command Line Usage:

Update the base intl_messages file for translators by running this
command from the project root:
```
flutter pub run intl_translation:extract_to_arb --output-dir=lib/l10n/res lib/l10n/app_localizations.dart
```
Note: We also add the --warnings-are-errors flag during CI to ensure that
strings that are improperly formatted will fail to build during PRs.

Once intl_messages has been created, it can be sent to translators where
they will create all the other `intl_*.arb` files. To link translations
back into the project once translators finish the translations, run this
command:
```
flutter pub run intl_translation:generate_from_arb --output-dir=lib/l10n/generated --no-use-deferred-loading lib/l10n/app_localizations.dart lib/l10n/res/intl_*.arb
```

### CI flow
1. The `extract-flutter-for-translators` workflow will run weekly on the `canvas-android-tasks` app in Bitrise
2. Merge in the pull request generated by `extract-flutter-for-translators` (does this for all flutter projects)
3. Let the weekly export job sync the arb files to S3 like any other language resource
4. Wait for translators to do their work, and run the import workflow on `canvas-android-tasks` to get a PR
5. Merge the PR to get the translated `intl_*.arb` files
6. Once the arb files have been merged, run the `generate-flutter-translations` workflow in Bitrise under the `canvas-android-tasks` app
7. Fix any projects that have errors, reporting any issues to our i18n project manager as well, and merge the PR!

---

## Viewing Code Coverage
To view code coverage, first install the `lcov` tool (`brew install lcov` for macOS).
Then, run this command from the root of the flutter project directory:
```
flutter pub run tools/code_coverage
```
This will run the project's unit tests with coverage enabled, remove 
excluded files from the resulting coverage info, generate an HTML report 
from that info, and open the report in the browser. You may skip opening 
the report in the browser with the `--dont-open` flag.
  
Exclusions can be configured by editing `tools/codecov_exclusions`. Note 
that this script is meant to be used locally by devs, but will hopefully 
serve as a starting point when we eventually wire up proper code coverage 
reporting via CI.

---

#### Unless otherwise noted, all parts of this application are licensed under the GPLv3 License.

```
Copyright (C) 2019 - present Instructure, Inc.
 
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, version 3 of the License.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
```
