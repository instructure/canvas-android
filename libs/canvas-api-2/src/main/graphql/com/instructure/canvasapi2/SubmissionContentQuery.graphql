#
# Copyright (C) 2025 - present Instructure, Inc.
#
#     Licensed under the Apache License, Version 2.0 (the "License");
#     you may not use this file except in compliance with the License.
#     You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
#     Unless required by applicable law or agreed to in writing, software
#     distributed under the License is distributed on an "AS IS" BASIS,
#     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#     See the License for the specific language governing permissions and
#     limitations under the License.
#
query SubmissionContent(
    $userId: ID!,
    $assignmentId: ID!,
    $pageSize: Int!,
    $nextCursor: String
) {
    submission(userId: $userId, assignmentId: $assignmentId) {
        _id
        userId
        ...SubmissionFields
        submissionHistoriesConnection(
            first: $pageSize,
            after: $nextCursor
        ) {
            pageInfo {
                hasNextPage
                endCursor
                startCursor
                hasPreviousPage
            }
            edges {
                node {
                    ...SubmissionFields
                }
            }
        }
    }
}

fragment SubmissionFields on SubmissionInterface {
    groupId
    state
    attempt
    body
    url
    previewUrl
    submissionType
    statusTag
    status
    submissionStatus
    customGradeStatus
    cachedDueDate
    submittedAt
    attachments {
        _id
        contentType
        mimeClass
        createdAt
        displayName
        id
        size
        thumbnailUrl
        title
        type
        updatedAt
        url
        submissionPreviewUrl
    }
    mediaObject {
        mediaType
        mediaDownloadUrl
        title
        thumbnailUrl
        mediaSources {
            url
        }
    }
    user {
        avatarUrl
        name
        shortName
        sortableName
    }
    assignment {
        submissionTypes
        htmlUrl
        anonymousGrading
        id
        courseId
        dueAt
        gradeGroupStudentsIndividually
        groupSet {
            groups {
                name
                _id
            }
        }
    }
    subAssignmentSubmissions {
        assignmentId
        customGradeStatusId
        enteredGrade
        enteredScore
        excused
        grade
        gradeMatchesCurrentSubmission
        late
        latePolicyStatus
        missing
        publishedGrade
        publishedScore
        score
        statusTag
        subAssignmentTag
    }
}
